<!--
	This node is copyright (c) 2017 Peter Scargill - but as I've had so
	many ideas from others - consider it free to use for whatever
	purpose you like. If you redesign it please remember to include
	my name and link to help promote the blog https://tech.scargill.net
	This software puts out one of two messages on change of state 
    which could be sent to the MQTT node, tests every minute and can
	be over-ridden manually. See help.
-->

<script type="text/x-red" data-template-name="bigtimer">
<div style="height: 100%; overflow-y: auto;">
     <div class="form-row">
		<label style="width:16%" for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
     </div>

	 <div class="form-row">
        <label style="width:16%" for="node-input-starttime"><i class="fa fa-clock-o"></i> On Time</label>
        <select style="width:26% !important" id="node-input-starttime">
            <option value=  "0">00:00</option>
            <option value= "15">00:15</option>
            <option value= "30">00:30</option>
            <option value= "45">00:45</option>
            <option value= "60">01:00</option>
            <option value= "75">01:15</option>
            <option value= "90">01:30</option>
            <option value="105">01:45</option>
            <option value="120">02:00</option>
            <option value="135">02:15</option>
            <option value="150">02:30</option>
            <option value="165">02:45</option>
            <option value="180">03:00</option>
            <option value="195">03:15</option>
            <option value="210">03:30</option>
            <option value="225">03:45</option>
            <option value="240">04:00</option>
            <option value="255">04:15</option>
            <option value="270">04:30</option>
            <option value="285">04:45</option>
            <option value="300">05:00</option>
            <option value="315">05:15</option>
            <option value="330">05:30</option>
            <option value="345">05:45</option>
            <option value="360">06:00</option>
            <option value="375">06:15</option>
            <option value="390">06:30</option>
            <option value="405">06:45</option>
            <option value="420">07:00</option>
            <option value="435">07:15</option>
            <option value="450">07:30</option>
            <option value="465">07:45</option>
            <option value="480">08:00</option>
            <option value="495">08:15</option>
            <option value="510">08:30</option>
            <option value="525">08:45</option>
            <option value="540">09:00</option>
            <option value="555">09:15</option>
            <option value="570">09:30</option>
            <option value="585">09:45</option>
            <option value="600">10:00</option>
            <option value="615">10:15</option>
            <option value="630">10:30</option>
            <option value="645">10:45</option>
            <option value="660">11:00</option>
            <option value="675">11:15</option>
            <option value="690">11:30</option>
            <option value="705">11:45</option>
            <option value="720">12:00</option>
            <option value="735">12:15</option>
            <option value="750">12:30</option>
            <option value="765">12:45</option>
            <option value="780">13:00</option>
            <option value="795">13:15</option>
            <option value="810">13:30</option>
            <option value="825">13:45</option>
            <option value="840">14:00</option>
            <option value="855">14:15</option>
            <option value="870">14:30</option>
            <option value="885">14:45</option>
            <option value="900">15:00</option>
            <option value="915">15:15</option>
            <option value="930">15:30</option>
            <option value="945">15:45</option>
            <option value="960">16:00</option>
            <option value="975">16:15</option>
            <option value="990">16:30</option>
            <option value="1005">16:45</option>
            <option value="1020">17:00</option>
            <option value="1035">17:15</option>
            <option value="1050">17:30</option>
            <option value="1065">17:45</option>
            <option value="1080">18:00</option>
            <option value="1095">18:15</option>
            <option value="1110">18:30</option>
            <option value="1125">18:45</option>
            <option value="1140">19:00</option>
            <option value="1155">19:15</option>
            <option value="1170">19:30</option>
            <option value="1185">19:45</option>
            <option value="1200">20:00</option>
            <option value="1215">20:15</option>
            <option value="1230">20:30</option>
            <option value="1245">20:45</option>
            <option value="1260">21:00</option>
            <option value="1275">21:15</option>
            <option value="1290">21:30</option>
            <option value="1305">21:45</option>
            <option value="1320">22:00</option>
            <option value="1335">22:15</option>
            <option value="1350">22:30</option>
            <option value="1365">22:45</option> 
			<option value="1380">23:00</option>
            <option value="1395">23:15</option>
            <option value="1410">23:30</option>
            <option value="1425">23:45</option>
            <option value="5000">Dawn</option>
            <option value="5001">Dusk</option>
           <option value="5003">Sunrise</option>
           <option value="5004">Sunset</option>
           <option value="5005">Night</option>
           <option value="5006">Night end</option>
			
        </select>

        <label style="width:16%" for="node-input-endtime"><i class="fa fa-clock-o"></i> Off Time</label>
        <select style="width:26% !important" id="node-input-endtime">
            <option value=  "0">00:00</option>
            <option value= "15">00:15</option>
            <option value= "30">00:30</option>
            <option value= "45">00:45</option>
            <option value= "60">01:00</option>
            <option value= "75">01:15</option>
            <option value= "90">01:30</option>
            <option value="105">01:45</option>
            <option value="120">02:00</option>
            <option value="135">02:15</option>
            <option value="150">02:30</option>
            <option value="165">02:45</option>
            <option value="180">03:00</option>
            <option value="195">03:15</option>
            <option value="210">03:30</option>
            <option value="225">03:45</option>
            <option value="240">04:00</option>
            <option value="255">04:15</option>
            <option value="270">04:30</option>
            <option value="285">04:45</option>
            <option value="300">05:00</option>
            <option value="315">05:15</option>
            <option value="330">05:30</option>
            <option value="345">05:45</option>
            <option value="360">06:00</option>
            <option value="375">06:15</option>
            <option value="390">06:30</option>
            <option value="405">06:45</option>
            <option value="420">07:00</option>
            <option value="435">07:15</option>
            <option value="450">07:30</option>
            <option value="465">07:45</option>
            <option value="480">08:00</option>
            <option value="495">08:15</option>
            <option value="510">08:30</option>
            <option value="525">08:45</option>
            <option value="540">09:00</option>
            <option value="555">09:15</option>
            <option value="570">09:30</option>
            <option value="585">09:45</option>
            <option value="600">10:00</option>
            <option value="615">10:15</option>
            <option value="630">10:30</option>
            <option value="645">10:45</option>
            <option value="660">11:00</option>
            <option value="675">11:15</option>
            <option value="690">11:30</option>
            <option value="705">11:45</option>
            <option value="720">12:00</option>
            <option value="735">12:15</option>
            <option value="750">12:30</option>
            <option value="765">12:45</option>
            <option value="780">13:00</option>
            <option value="795">13:15</option>
            <option value="810">13:30</option>
            <option value="825">13:45</option>
            <option value="840">14:00</option>
            <option value="855">14:15</option>
            <option value="870">14:30</option>
            <option value="885">14:45</option>
            <option value="900">15:00</option>
            <option value="915">15:15</option>
            <option value="930">15:30</option>
            <option value="945">15:45</option>
            <option value="960">16:00</option>
            <option value="975">16:15</option>
            <option value="990">16:30</option>
            <option value="1005">16:45</option>
            <option value="1020">17:00</option>
            <option value="1035">17:15</option>
            <option value="1050">17:30</option>
            <option value="1065">17:45</option>
            <option value="1080">18:00</option>
            <option value="1095">18:15</option>
            <option value="1110">18:30</option>
            <option value="1125">18:45</option>
            <option value="1140">19:00</option>
            <option value="1155">19:15</option>
            <option value="1170">19:30</option>
            <option value="1185">19:45</option>
            <option value="1200">20:00</option>
            <option value="1215">20:15</option>
            <option value="1230">20:30</option>
            <option value="1245">20:45</option>
            <option value="1260">21:00</option>
            <option value="1275">21:15</option>
            <option value="1290">21:30</option>
            <option value="1305">21:45</option>
            <option value="1320">22:00</option>
            <option value="1335">22:15</option>
            <option value="1350">22:30</option>
            <option value="1365">22:45</option> 
			<option value="1380">23:00</option>
            <option value="1395">23:15</option>
            <option value="1410">23:30</option>
            <option value="1425">23:45</option>
            <option value="5000">Dawn</option>
            <option value="5001">Dusk</option>
            <option value="5003">Sunrise</option>
            <option value="5004">Sunset</option>
            <option value="5005">Night</option>
            <option value="5006">Night end</option>
            <option value="10001">1 minute</option>
            <option value="10002">2 minutes</option>
            <option value="10005">5 minutes</option>
            <option value="10010">10 minutes</option>
            <option value="10015">15 minutes</option>
            <option value="10030">30 minutes</option>
            <option value="10060">60 minutes</option>
            <option value="10090">90 minutes</option>
            <option value="10120">120 minutes</option>
        </select>
    </div>

	<div class="form-row">
		<label  style="width:16%" for="node-input-startoff"><i class="fa fa-clock-o"></i> On Offset</label>
		<input  style="width:26%" type="text" id="node-input-startoff" placeholder="0">
	
		<label  style="width:16%" for="node-input-endoff"><i class="fa fa-clock-o"></i> Off Offset</label>
		<input  style="width:26%" type="text" id="node-input-endoff" placeholder="0">
	</div>
	
	<div class="form-row">	
		<label style="width:16%" for="node-input-lat"><i class="fa fa-globe"></i> Latitude</label>
		<input style="width:26%" type="text" id="node-input-lat" placeholder="51.025">

		<label style="width:16%" for="node-input-lon"><i class="fa fa-globe"></i> Longitude</label>
		<input style="width:26%" type="text" id="node-input-lon" placeholder="-1.4">
	</div>

  
	<div class="form-row">
		<label style="width:16%" for="node-input-outtopic"><i class="fa fa-tag"></i> Topic Msg</label>
		<input style="width:26%" type="text" id="node-input-outtopic" placeholder="MQTT Topic">

		<label style="width:16%" for="node-input-offs"><i class="fa fa-clock-o"></i> Man UTC</label>
		<input style="width:26%" type="text" id="node-input-offs" placeholder="0">
	</div>

	<div class="form-row">
		<label style="width:16%" for="node-input-outpayload1"><i class="fa fa-tag"></i> ON Msg</label>
		<input style="width:26%" type="text" id="node-input-outpayload1" placeholder="MQTT Payload">

		<label style="width:16%" for="node-input-outpayload2"><i class="fa fa-tag"></i> OFF Msg</label>
		<input style="width:26%" type="text" id="node-input-outpayload2" placeholder="MQTT Payload">
	</div>
	<div class="form-row">
		<label style="width:16%" for="node-input-outtext1"><i class="fa fa-tag"></i> ON Text</label>
		<input type="text" id="node-input-outtext1" placeholder="Text">
	</div>
	
	<div class="form-row">
		<label style="width:16%" for="node-input-outtext2"><i class="fa fa-tag"></i> OFF Text</label>
		<input type="text" id="node-input-outtext2" placeholder="Text">
	</div>

	<div class="form-row">
		<label style="width:16%" for="node-input-timeout"><i class="fa fa-tag"></i> Timeout</label>
		<input type="text" id="node-input-timeout" placeholder="Text">
	</div>
	
	<p>Special days of the year (optional) day=1-31  month=1-12</p>
	<div class="form-row">
		<label  style="width:16%" for="node-input-day1"><i class="fa fa-clock-o"></i> Day 1</label>
		<input  style="width:26%" type="text" id="node-input-day1" placeholder="0">
		<label  style="width:16%" for="node-input-month1"><i class="fa fa-clock-o"></i> Month 1</label>
		<input  style="width:26%" type="text" id="node-input-month1" placeholder="0">
	</div>
		
	<div class="form-row">
		<label  style="width:16%" for="node-input-day2"><i class="fa fa-clock-o"></i> Day 2</label>
		<input  style="width:26%" type="text" id="node-input-day2" placeholder="0">
		<label  style="width:16%" for="node-input-month2"><i class="fa fa-clock-o"></i> Month 2</label>
		<input  style="width:26%" type="text" id="node-input-month2" placeholder="0">
	</div>
		
	<div class="form-row">
		<label  style="width:16%" for="node-input-day3"><i class="fa fa-clock-o"></i> Day 3</label>
		<input  style="width:26%" type="text" id="node-input-day3" placeholder="0">
		<label  style="width:16%" for="node-input-month3"><i class="fa fa-clock-o"></i> Month 3</label>
		<input  style="width:26%" type="text" id="node-input-month3" placeholder="0">
	</div>
		
	<div class="form-row">
		<label  style="width:16%" for="node-input-day4"><i class="fa fa-clock-o"></i> Day 4</label>
		<input  style="width:26%" type="text" id="node-input-day4" placeholder="0">
		<label  style="width:16%" for="node-input-month4"><i class="fa fa-clock-o"></i> Month 4</label>
		<input  style="width:26%" type="text" id="node-input-month4" placeholder="0">
	</div>
		
	<div class="form-row">
		<label  style="width:16%" for="node-input-day5"><i class="fa fa-clock-o"></i> Day 5</label>
		<input  style="width:26%" type="text" id="node-input-day5" placeholder="0">
		<label  style="width:16%" for="node-input-month5"><i class="fa fa-clock-o"></i> Month 5</label>
		<input  style="width:26%" type="text" id="node-input-month5" placeholder="0">
	</div>
	
	<p>Special weekdays of the month (optional) Sunday=1 etc. Week=1-5</p>
	<div class="form-row">
		<label  style="width:16%" for="node-input-d1"><i class="fa fa-clock-o"></i> Day 1</label>
		<input  style="width:26%" type="text" id="node-input-d1" placeholder="0">
		<label  style="width:16%" for="node-input-w1"><i class="fa fa-clock-o"></i> Week 1</label>
		<input  style="width:26%" type="text" id="node-input-w1" placeholder="0">
	</div>

	<div class="form-row">
		<label  style="width:16%" for="node-input-d2"><i class="fa fa-clock-o"></i> Day 2</label>
		<input  style="width:26%" type="text" id="node-input-d2" placeholder="0">
		<label  style="width:16%" for="node-input-w2"><i class="fa fa-clock-o"></i> Week 2</label>
		<input  style="width:26%" type="text" id="node-input-w2" placeholder="0">
	</div>

	<div class="form-row">
		<label  style="width:16%" for="node-input-d3"><i class="fa fa-clock-o"></i> Day 3</label>
		<input  style="width:26%" type="text" id="node-input-d3" placeholder="0">
		<label  style="width:16%" for="node-input-w3"><i class="fa fa-clock-o"></i> Week 3</label>
		<input  style="width:26%" type="text" id="node-input-w3" placeholder="0">
	</div>

	<div class="form-row">
		<label  style="width:16%" for="node-input-d4"><i class="fa fa-clock-o"></i> Day 4</label>
		<input  style="width:26%" type="text" id="node-input-d4" placeholder="0">
		<label  style="width:16%" for="node-input-w4"><i class="fa fa-clock-o"></i> Week 4</label>
		<input  style="width:26%" type="text" id="node-input-w4" placeholder="0">
	</div>

	<div class="form-row">
		<label  style="width:16%" for="node-input-d5"><i class="fa fa-clock-o"></i> Day 5</label>
		<input  style="width:26%" type="text" id="node-input-d5" placeholder="0">
		<label  style="width:16%" for="node-input-w5"><i class="fa fa-clock-o"></i> Week 5</label>
		<input  style="width:26%" type="text" id="node-input-w5" placeholder="0">
	</div>

		<style>
	input[type=checkbox] { vertical-align:top; position:relative; bottom:1px; } 
	</style>
  
	<div>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-sun" placeholder="sun" >Sun</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-mon" placeholder="mon" >Mon</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-tue" placeholder="tue" >Tue</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-wed" placeholder="wed" >Wed</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-thu" placeholder="thu" >Thu</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-fri" placeholder="fri" >Fri</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-sat" placeholder="sat" >Sat</span>
	</div>
	<br/>
	<div>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-jan" placeholder="jan" >Jan</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-feb" placeholder="feb" >Feb</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-mar" placeholder="mar" >Mar</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-apr" placeholder="apr" >Apr</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-may" placeholder="may" >May</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-jun" placeholder="jun" >Jun</span>
		<br/>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-jul" placeholder="jul" >Jul</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-aug" placeholder="aug" >Aug</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-sep" placeholder="sep" >Sep</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-oct" placeholder="oct" >Oct</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-nov" placeholder="nov" >Nov</span>
		<span style="width: 50px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-dec" placeholder="dec" >Dec</span>
	</div>
	
	<br/>
		<div>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-suspend" placeholder="suspend" >Suspend schedule</span>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-random" placeholder="random" >Randomise offsets</span>
		<br/>
	</div>
		<div>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-odd" placeholder="odd" >BAN Odd days</span>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-even" placeholder="even" >BAN Even days</span>
		<br/>
	</div>

	<div>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-repeat" placeholder="repeat" >Repeat output</span>
		<span style="width: 150px; float: left; margin-left: 5px;"><input type="checkbox" id="node-input-atstart" placeholder="atstart" >Output at startup</span>
		<br/>
	</div><br/>
	
</div>
	
</script>

<script type="text/x-red" data-help-name="bigtimer">
    <h3>Details</h3>
    <p><b>Bigtimer</b> is probably the ultimate Node-Red timing node, sending messages for start and end conditions at any time, day, month or special day.</p>
	<p>In the simplest case, Bigtimer requires no input and you need only to consider the first output. But Bigtimer can be much more.</p>
    
    <h3>Outputs</h3>
    <p>The first output sends out a message at your set ON or OFF times (and if the repeat tickbox is ticked - every minute)</p>
	<p>The second output simply sends the state - 1 or 0 every minute as well as echoing the status in msg.state and msg.time. (from v1.5.6 onwards several properties have been added to msg)</p>
	<p>The third output sends an optional message for ON and OFF both states - suitable for speech output or a log (this happens only at ON or OFF times, NOT every minute).</p>

	<h3>Inputs</h3>
    <p>The input can be used as an override by simply sending a text or numeric message. Valid (case-insensitive) messages passed in via msg.payload include: 
        <ul>
         <li>1 (or on)</li>
         <li>0 (or off)</li>
         <li>auto (or default)</li>
         <li>manual</li>
         <li>sync</li>
         <li>stop</li>
         <li>on_override</li>
         <li>off_override</li>
         <li>timer</li>
         </ul>
    </p>
    <h3>More</h3>
	<p>The first two override messages (1/0) time-out after 24 hours (1440 minutes, user-settable) OR at the next change of schedule. If you have also selected "manual" - the outputs will NOT revert back at change of schedule (auto to reset).</p>
    <p>The schedule can be paused by the interface tick box or by the "manual" command (use the "auto" command to return to normal)</p>
    <p>on_override and off_override can be used to supercede the set inputs for on and off times - "on_override 20 15" for example (without the quotes) for 8:15pm. These settings are volatile, i.e. not restored when Node-Red is restarted. It may take up to a minute for these controls to take effect.</p>
	<p>Manual UTC is optional offset (hrs) in case you have a special reason not to have the right time on your computer! Normally 0.</p>
    <p>Remember, the status display only updates once per minute. If you have Bigtimer set to OFF you should see a black "No action today" message - if you use manual inject to override - it may take up to a minute for this message to re-appear</p>
    <p>The Dawn and Dusk offsets can be both positive (+ve) for minutes later or negative (-ve) for minutes earlier.</p>
    <p>For those occasions where "alternative days" are required there are checkbox options to BAN output on even and/or odd days of the month.</p>
	
    <h3>References</h3>
	<p>See my tech blog for more information <a target="_blank" href="https://tech.scargill.net/big-timer">here</a></p>
    <p>Bigtimer uses the suncalc module.</p>	
</script>



<script type="text/javascript">
    RED.nodes.registerType('bigtimer',{
        category: 'scargill-input',
        color:"#99ff00",
        inputLabels: "Optional overrides",
        outputLabels: ["one-off message","outputs every minute","speech/log output"],
        defaults: {
            outtopic: {value:"",validate:RED.validators.regex(/^[\.@a-zA-Z0-9_\/\-]*$/) },
            outpayload1: {value:""},
            outpayload2: {value:""},
		    name: {value:"Big Timer",required: true },
            lat: {value:"", required: true},
            lon: {value:"", required: true},
			starttime: {value:5001, required: true },
			endtime: {value:1425, required: true },
			startoff: {value:0, validate:RED.validators.number() },
			endoff: {value:0, validate:RED.validators.number() },
			offs: {value:0, validate:RED.validators.number() },
			outtext1: {value:""},
			outtext2: {value:""},
			timeout: {value: 1440,validate:RED.validators.number() },
			sun: {value:true},
			mon: {value:true},
			tue: {value:true},
			wed: {value:true},
			thu: {value:true},
			fri: {value:true},
			sat: {value:true},
			jan: {value:true},
			feb: {value:true},
			mar: {value:true},
			apr: {value:true},
			may: {value:true},
			jun: {value:true},
			jul: {value:true},
			aug: {value:true},
			sep: {value:true},
			oct: {value:true},
			nov: {value:true},
			dec: {value:true},
			
			day1: {value:0, validate:RED.validators.number()},
			month1: {value:0, validate:RED.validators.number()},
			day2: {value:0, validate:RED.validators.number()},
			month2: {value:0, validate:RED.validators.number()},
			day3: {value:0, validate:RED.validators.number()},
			month3: {value:0, validate:RED.validators.number()},
			day4: {value:0, validate:RED.validators.number()},
			month4: {value:0, validate:RED.validators.number()},
			day5: {value:0, validate:RED.validators.number()},
			month5: {value:0, validate:RED.validators.number()},

			d1: {value:0, validate:RED.validators.number()},
			w1: {value:0, validate:RED.validators.number()},	
			d2: {value:0, validate:RED.validators.number()},
			w2: {value:0, validate:RED.validators.number()},	
			d3: {value:0, validate:RED.validators.number()},
			w3: {value:0, validate:RED.validators.number()},	
			d4: {value:0, validate:RED.validators.number()},
			w4: {value:0, validate:RED.validators.number()},	
			d5: {value:0, validate:RED.validators.number()},
			w5: {value:0, validate:RED.validators.number()},	
			
			suspend: {value:false, required: false},
			random: {value:false, required: false},
			repeat: {value:true, required: false},
			atstart: {value:true, required: false},
            odd: {value:false, required: false},
            even: {value:false, required: false}
			},
        inputs:1,
        outputs:3,
        icon: "timer.png",
        label: function() {
            return this.name||"bigtimer";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (($("#node-input-lat").val() === "") && ($("#node-input-lon").val() === "")) {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        $("#node-input-lat").val(Number(position.coords.latitude.toFixed(5)));
                        $("#node-input-lon").val(Number(position.coords.longitude.toFixed(5)));
                    });
                }
            }
        }
    });

</script>
